@page "/customers/{Id:long}"

@if (Customer == null)
{
    <Loading />
}
else
{
    <PageTemplate Title="@Customer.CompanyName" Icon="fa-solid fa-building">
        <BreadcrumbContent>
            <Breadcrumb><a href="/">Home</a></Breadcrumb>
            <Breadcrumb><a href="customers">Customers</a></Breadcrumb>
            <Breadcrumb>Details</Breadcrumb>
        </BreadcrumbContent>
        <HeaderButtons>
            <button class="btn btn-primary btn-sm" disabled="@(Customer == null)" @onclick="LaunchUpdateDialog">Edit Customer</button>
        </HeaderButtons>
        <MainContent>
            <div class="row">
                <div class="col">
                    <h6>Location</h6>
                    <small class="text-muted mb-0">@Customer.Location.ToString()</small>

                    <h6>Audit Trail</h6>
                    <CustomerAuditTrail @ref="AuditTrail" CustomerId="Id" />
                </div>
                <div class="col-3">
                    <h6>Active Work Orders</h6>
                    @if (!Customer.ActiveWorkOrders.Any())
                    {
                        <p class="fst-italic text-muted">No active work orders.</p>
                    }
                    else
                    {
                        <div class="list-group">
                            @foreach (var workOrder in Customer.ActiveWorkOrders)
                            {
                                <a href="work-orders/@workOrder.Id" class="list-group-item list-group-item-action d-flex align-items-center">
                                    <WorkOrderReferenceNumber Value="@workOrder.ReferenceNumber" />
                                    <WorkOrderStatusBadge Class="ms-auto" Status="workOrder.Status" />
                                </a>
                            }
                        </div>
                    }
                </div>
            </div>
        </MainContent>
    </PageTemplate>
}
